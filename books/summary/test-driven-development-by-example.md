테스트주도개발, 켄트 벡 저
===
> [테스트 주도 개발](http://book.naver.com/bookdb/book_detail.nhn?bid=7443642)

사실 테스트에 관한 책을 이 전에 몇 권 읽은 적이 있다. 

[고품질 쾌속개발을 위한 TDD 실천법과 도구](http://book.naver.com/bookdb/book_detail.nhn?bid=6291557) 와 다른 하나는 [토비의 스프링](http://book.naver.com/bookdb/book_detail.nhn?bid=7006516)이다. 토비의 스프링은 계속 유닛테스트를 활용하며 스프링 프레임워크를 학습한다. 두 권의 책 모두 틀림 없이 훌륭한 책이지만, 실무에서는 어떻게 적용을 해야할 지 모르겠다. 그냥 눈 앞이 시커매진다. 뭐 어떻게 하라고?

그리고 사실 들어가며 쓰는 이 글을, 지난번 [NHN은 이렇게 한다 소프트웨어 품질관리 를 읽은 후기](http://onoctober.tistory.com/69)의 시작부에도 똑같이 썼다.

정리해보자면, TDD에 관한 책을 2권(TDD실천법과 도구, 소프트웨어 품질관리), 특정 기술을 학습하며 TDD 실제 예제를 따라해본 것이 2권 (토비의 스프링,  [스프링을 이용한 RESTful 웹 서비스](http://book.naver.com/bookdb/book_detail.nhn?bid=7523340)) 임에도 불구하고 실무에서 자동화 테스트는 고사하고 @Test 어노테이션조차 써본 적이 없다.

점점 내가 구현 하는 클래스와 메소드의 복잡도는 높아지는데 기능 하나를 확인 하려면 컴파일 하고, 톰캣 서버 구동하고 직접 C.R.U.D 해보고. 수정하고, 컴파일하고, 톰캣 서버 구동하고. 그렇게 번거롭게 몇 번 테스트랍시고 해본 후에는 이 기능은 완성됐다고 말한다. 

말하면서도 불안하다. 내가 짠 로직에 대한 자신이 없다. 그런데 또 다른 새 기능을 구현해야 한다. 불안감은 까맣게 잊고 새 기능 구현에 집중한다. 반복 - 반복- 악순환의 반복.

> 50년이 지난 지금 소프트웨어 개발 커뮤니티는 동일한 깨달음에 도달하고 있습니다. 프로그래머가 자기 작업의 품질에 대한 우선적 책임을 져야 한다는 깨달음이죠.
>
> - 켄트 벡

이대로는 안되겠다는 생각이 들었다. 물론 단위 테스트가 오류를 100% 커버하진 못하지만  개발(테스트)시간을 단축하고, 기능 구현 후 내가 느끼는 불안감을 크게 줄일 수 있는 방법은 TDD 적용이라는 생각이 들었다. 그래서 켄트벡 아저씨의 TDD 를 집어들게 되었다.

> 작동하는 깔끔한 코드(Clean code that works). 론 제프리즈의 핵심을 찌르는 이 한마디가 바로 테스트 주도 개발의 궁극적인 목표다.
>
> -켄트벡 저. 테스트주도개발. 김창준, 강규영 역. 인사이트. 2005\. 22페이지
>
> 
>
> '제대로 동작하는'을 푸는 동시에 '깨끗한 코드'를 해결하려는 것은 한번에 하기에 너무 많은 일일 수 있다. 그렇게 되면 우선 '제대로 동작하는'으로 되돌아 가서 그걸 해결하고, 그 후에 '깨끗한 코드'를 느긋하게 해결하도록 하라.
>
> -켄트벡 저. 테스트주도개발. 김창준, 강규영 역. 인사이트. 2005\. 249페이지

Divide and Conquer (분할정복) ! TDD의 목적은 잘 작동하는 깨끗한 코드인데, 이건 정말 힘든 일이다. 여기에 분할정복방법을 적용하여 일단 잘 작동하도록 만들고(테스트를 통과 하도록) 리펙토링을 거쳐 깨끗한 코드를 만들어낸다. 테스트 -> 리펙토링의 절차를 걸치면서 자연스럽게 여러 검증 단계를 거치게 되는 것 같다.

테스트 주도 개발에 관련된 몇 권의 책을 접해 보면서 공통적으로 강조하는 것은

1.  할일 목록 리스트를 작성한다.
2.  테스트를 먼저 작성한다. (실패하는)
3.  작게 자주 테스트한다 (주기를 짧게)
4.  수정한다

정도인 것 같다. 켄트벡의 책에서는 클라이언트의 요구사항을 정의한 후, 예제를 시작하며 등장하는 첫 테스트 코드는 아래와 같다.

```java
@Test
public void testMultiplication() {
    Dollar five = new Dollar(5);
    five.times(2);
    assertEquals(10, five.amount);
}
```

Dollar 라는 클래스도 존재하지 않고, 당연히 생성자도 없을테고, 메소드도 없을테니 무조건 실패하는 테스트다.여기서부터 시작해서 점점 필요한 클래스와 메소드를 정의하고 테스트를 하며 점진적으로 개선해 나간다. 테스트 주기를 짧게 짧게 하며 개선해 나가다 보면 초록불(JUnit 에서 테스트를 성공하면 초록불이 들어온다)에 중독되어 간다.

완벽한 구현이 아닌 테스트를 통과하는 것에 집중하고, 스텁 구현을 통해 테스트를 빠르게 통과한다. 마지막 장인 'TDD 마스터하기' 에서

*   피드백이 필요한 때는 언제인가?
*   테스트를 지워야 할 때는 언제인가?
*   TDD는 누구를  위한 것인가?

라는 질문을 하는데, 책을 읽으며 느낀 것은 내가 작성하는 테스트 코드의 커버리지도 경험에 의해 많이 발전하게 되는 것 같다는 생각이 들었다. 결국 많은 시행착오와 오류를 경험 해봐야 커버할 수 있는 범위가 더 넓어지는 것이다. 그리고 실패하는 테스트 코드를 작성한다는 것은 어쩌면 그것을 간접적으로 빠르게 더 자주 경험할 수 있게 해주는 것이 아닌가 싶다.

> TDD는 코드에 감정적 애착을 형성하는 해커들에게 좋다. 젊은 시절 나의 가장 큰 불만은 이런 것이었다. 엄청난 흥미를 가지고 새 프로젝트를 시작해서는 시간이 지남에 따라 서서히 코드가 썩어가는 걸 보게 된다. 일년쯤 지나면 하루라도 빨리 냄새 나는 코드를 던져 버리고 다음 프로젝트가 시작되기만을 기다리는 것이다.
>
> -켄트벡 저. 테스트주도개발. 김창준, 강규영 역. 인사이트. 2005\. 320페이지